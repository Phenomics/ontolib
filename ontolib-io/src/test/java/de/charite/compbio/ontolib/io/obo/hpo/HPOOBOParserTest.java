package de.charite.compbio.ontolib.io.obo.hpo;

import static org.junit.Assert.assertEquals;

import com.google.common.collect.ImmutableSortedMap;
import com.google.common.collect.ImmutableSortedSet;
import de.charite.compbio.ontolib.formats.hpo.HPOntology;
import de.charite.compbio.ontolib.io.utils.ResourceUtils;
import java.io.File;
import java.io.IOException;
import org.junit.Before;
import org.junit.Rule;
import org.junit.Test;
import org.junit.rules.TemporaryFolder;

public class HPOOBOParserTest {

  @Rule
  public TemporaryFolder tmpFolder = new TemporaryFolder();

  private File hpoHeadFile;

  @Before
  public void setUp() throws IOException {
    hpoHeadFile = tmpFolder.newFile("hp_head.obo");
    ResourceUtils.copyResourceToFile("/hp_head.obo", hpoHeadFile);
  }

  @Test
  public void testParseHPOHead() throws IOException {
    final HPOOBOParser parser = new HPOOBOParser(hpoHeadFile, true);
    final HPOntology ontology = parser.parse();

    assertEquals(
        "ImmutableDirectedGraph [edgeLists={ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=2]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=3]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=5]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=6]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=7]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=107]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1415]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1416]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1447]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1448]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1451]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1453]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1455]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1456]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1461]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1463]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1507]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1526]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=4715]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=MSH], id=21782]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=SNOMEDCT_US], id=82525005]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=SNOMEDCT_US], id=204962002]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=SNOMEDCT_US], id=258211005]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=SNOMEDCT_US], id=263681008]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=UMLS], id=441748]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=UMLS], id=443147]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=UMLS], id=444868]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=UMLS], id=1708511]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=UMLS], id=3714581]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=UMLS], id=4020899]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]], ImmutableTermID [prefix=ImmutableTermPrefix [value=UMLS], id=4025901]=ImmutableVertexEdgeList [inEdges=[], outEdges=[]]}, edgeCount=0]",
        ontology.getGraph().toString());
    assertEquals(
        "[ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=2], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=3], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=5], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=6], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=7]]",
        ImmutableSortedSet.copyOf(ontology.getTermIDs()).toString());
    assertEquals(
        "{ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1]=HPOTerm [id=ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1], altTermIDs=[], name=All, definition=null, comment=Root of all terms in the Human Phenotype Ontology., subsets=[], synonyms=[], obsolete=false, createdBy=null, creationDate=null], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=2]=HPOTerm [id=ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=2], altTermIDs=[], name=Abnormality of body height, definition=\"Deviation from the norm of height with respect to that which is expected according to age and gender norms.\", comment=null, subsets=[], synonyms=[ImmutableTermSynonym [value=\"Abnormality of body height\", scope=EXACT, synonymTypeName=layperson, termXRefs=[]]], obsolete=false, createdBy=peter, creationDate=2008-02-27T02:20:00Z], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=3]=HPOTerm [id=ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=3], altTermIDs=[ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=4715]], name=Multicystic kidney dysplasia, definition=\"Multicystic dysplasia of the kidney is characterized by multiple cysts of varying size in the kidney and the absence of a normal pelvicaliceal system. The condition is associated with ureteral or ureteropelvic atresia, and the affected kidney is nonfunctional.\", comment=Multicystic kidney dysplasia is the result of abnormal fetal renal development in which the affected kidney is replaced by multiple cysts and has little or no residual function. The vast majority of multicystic kidneys are unilateral. Multicystic kidney can be diagnosed on prenatal ultrasound., subsets=[], synonyms=[ImmutableTermSynonym [value=\"Multicystic dysplastic kidney\", scope=EXACT, synonymTypeName=null, termXRefs=[]], ImmutableTermSynonym [value=\"Multicystic kidneys\", scope=EXACT, synonymTypeName=null, termXRefs=[]], ImmutableTermSynonym [value=\"Multicystic renal dysplasia\", scope=EXACT, synonymTypeName=null, termXRefs=[]]], obsolete=false, createdBy=null, creationDate=null], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=5]=HPOTerm [id=ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=5], altTermIDs=[ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1453], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1461]], name=Mode of inheritance, definition=\"The pattern in which a particular genetic trait or disorder is passed from one generation to the next.\", comment=null, subsets=[], synonyms=[ImmutableTermSynonym [value=\"Inheritance\", scope=EXACT, synonymTypeName=null, termXRefs=[]]], obsolete=false, createdBy=null, creationDate=null], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=6]=HPOTerm [id=ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=6], altTermIDs=[ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1415], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1447], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1448], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1451], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1455], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1456], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1463]], name=Autosomal dominant inheritance, definition=\"A mode of inheritance that is observed for traits related to a gene encoded on one of the autosomes (i.e., the human chromosomes 1-22) in which a trait manifests in heterozygotes. In the context of medical genetics, an autosomal dominant disorder is caused when a single copy of the mutant allele is present. Males and females are affected equally, and can both transmit the disorder with a risk of 50% for each child of inheriting the mutant allele.\", comment=null, subsets=[], synonyms=[ImmutableTermSynonym [value=\"Autosomal dominant\", scope=EXACT, synonymTypeName=null, termXRefs=[]], ImmutableTermSynonym [value=\"Autosomal dominant form\", scope=RELATED, synonymTypeName=null, termXRefs=[ImmutableTermXRef [id=null, description=null]]], ImmutableTermSynonym [value=\"Autosomal dominant type\", scope=RELATED, synonymTypeName=null, termXRefs=[ImmutableTermXRef [id=null, description=null]]]], obsolete=false, createdBy=null, creationDate=null], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=7]=HPOTerm [id=ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=7], altTermIDs=[ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1416], ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1526]], name=Autosomal recessive inheritance, definition=\"A mode of inheritance that is observed for traits related to a gene encoded on one of the autosomes (i.e., the human chromosomes 1-22) in which a trait manifests in homozygotes. In the context of medical genetics, autosomal recessive disorders manifest in homozygotes (with two copies of the mutant allele) or compound heterozygotes (whereby each copy of a gene has a distinct mutant allele).\", comment=null, subsets=[], synonyms=[ImmutableTermSynonym [value=\"Autosomal recessive\", scope=EXACT, synonymTypeName=null, termXRefs=[]], ImmutableTermSynonym [value=\"Autosomal recessive form\", scope=RELATED, synonymTypeName=null, termXRefs=[ImmutableTermXRef [id=null, description=null]]], ImmutableTermSynonym [value=\"Autosomal recessive predisposition\", scope=RELATED, synonymTypeName=null, termXRefs=[]]], obsolete=false, createdBy=null, creationDate=null]}",
        ImmutableSortedMap.copyOf(ontology.getTermMap()).toString());
    assertEquals(
        "{1=HPOTermRelation [source=ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=7], dest=ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=5], id=1, relationQualifier=IS_A]}",
        ImmutableSortedMap.copyOf(ontology.getRelationMap()).toString());
    assertEquals("ImmutableTermID [prefix=ImmutableTermPrefix [value=HP], id=1]",
        ontology.getRootTermID().toString());
  }

}
